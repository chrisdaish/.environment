#!/bin/bash
# Docker launch commands

### Darwin Docker Launch
if [[ `uname` = 'Darwin' ]]; then
  source $HOME/bin/startDocker.sh
fi

### Housekeeping
docker-cleanup(){
  docker rm $(docker ps --filter status=exited -q 2>/dev/null) 2>/dev/null
  docker rmi $(docker images --filter dangling=true -q 2>/dev/null) 2>/dev/null
}

del_stopped(){
  local name=$1
  local state=$(docker inspect --format "{{.State.Running}}" $name 2>/dev/null)

  if [[ "$state" == "false" ]]; then
    docker rm $name
  fi
}

### Container launchers
acroread(){
  del_stopped acroread

  docker run -d \
    -e DISPLAY=unix$DISPLAY \
    -e uid=$(id -u) \
    -e gid=$(id -g) \
    -v /etc/localtime:/etc/localtime:ro \
    -v $HOME/Downloads:/home/acroread/Downloads:rw \
    -v $HOME/Documents:/home/acroread/Documents:rw \
    -v $HOME/.acroread:/home/acroread/.adobe/Acrobat/9.0:rw \
    -v $HOME/.docker-environment/cups/client.conf:/etc/cups/client.conf:ro \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -v /var/run/cups:/var/run/cups:ro \
    --name acroread \
    chrisdaish/acroread
}

chrome(){
  del_stopped chrome

  docker run -d \
    -e DISPLAY=unix$DISPLAY \
    -e ARGS="'--proxy-pac-url=$http_proxy_pac'" \
    -e uid=$(id -u) \
    -e gid=$(id -g) \
    -v /etc/localtime:/etc/localtime:ro \
    -v $HOME/Downloads:/home/google-chrome/Downloads:rw \
    -v $HOME/.chrome:/home/google-chrome/.config/google-chrome \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -v /var/run/cups:/var/run/cups:ro \
    -v /dev/snd:/dev/snd \
    -v /dev/shm:/dev/shm \
    -v $HOME/.docker-environment/alsa/asound.conf:/etc/asound.conf:ro \
    --name chrome \
    --net host \
    --privileged \
    chrisdaish/google-chrome

  # exit current shell
  exit 0
}

firefox(){
  del_stopped firefox

  docker run -d \
    -e DISPLAY=unix$DISPLAY \
    -e uid=$(id -u) \
    -e gid=$(id -g) \
    -v /etc/localtime:/etc/localtime:ro \
    -v $HOME/Downloads:/home/firefox/Downloads:rw \
    -v $HOME/.firefox:/home/firefox/.mozilla:rw \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -v /var/run/cups:/var/run/cups:ro \
    -v /dev/snd:/dev/snd \
    -v $HOME/.docker-environment/alsa/asound.conf:/etc/asound.conf:ro \
    --name firefox \
    --net host \
    --privileged \
    chrisdaish/firefox

  # exit current shell
  exit 0
}

vlc(){
  del_stopped vlc

  docker run -d \
    -e DISPLAY=unix$DISPLAY \
    -e uid=$(id -u) \
    -e gid=$(id -g) \
    -v /etc/localtime:/etc/localtime:ro \
    -v $HOME/Downloads:/home/vlc/Downloads:rw \
    -v $HOME/Documents:/home/vlc/Documents:rw \
    -v $HOME/.vlc:/home/vlc/.config/vlc:rw \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -v /var/run/cups:/var/run/cups:ro \
    -v /dev/snd:/dev/snd \
    -v $HOME/.docker-environment/alsa/asound.conf:/etc/asound.conf:ro \
    --name vlc \
    --privileged \
    chrisdaish/vlc
}

weather(){
  del_stopped weather

  docker run \
    -e http_proxy=$http_proxy \
    -v /etc/localtime:/etc/localtime:ro \
    --name weather \
    --net host \
    jess/weather --units 'uk' --location 'PO15 7PA'
}

